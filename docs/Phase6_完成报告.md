# Phase 6 å®ŒæˆæŠ¥å‘Š: ETFæ”¯æŒä¸å®šæŠ•ç­–ç•¥

**å®Œæˆæ—¥æœŸ**: 2026-02-15
**å®é™…è€—æ—¶**: 1å¤©
**é¢„è®¡è€—æ—¶**: 3å¤© (æå‰2å¤©)
**æå‰è¿›åº¦**: ç´¯è®¡10.5å¤©

---

## å®ç°åŠŸèƒ½

### 1. ETFè‚¡ç¥¨æ± æ‰©å±• (0.2å¤©)

**æ–°å¢ETFæ± **:

**Aè‚¡ETFæ±  (10åªæ ¸å¿ƒETF)**:
```python
CN_ETF_POOL = [
    "510300",  # æ²ªæ·±300ETF
    "510500",  # ä¸­è¯500ETF
    "159915",  # åˆ›ä¸šæ¿ETF
    "515000",  # ç§‘åˆ›50
    "512880",  # è¯åˆ¸ETF
    "515050",  # 5GETF
    "518880",  # é»„é‡‘ETF
    "511260",  # ä¸Šè¯10å¹´æœŸå›½å€ºETF
    "513100",  # çº³æ–¯è¾¾å…‹ETF (QDII)
    "513500",  # æ ‡æ™®500ETF (QDII)
]
```

**ç¾è‚¡ETFæ±  (10åªæ ¸å¿ƒETF)**:
```python
US_ETF_POOL = [
    "SPY",     # S&P 500 ETF
    "QQQ",     # çº³æ–¯è¾¾å…‹100
    "IWM",     # å°ç›˜è‚¡Russell 2000
    "VTI",     # å…¨å¸‚åœºæŒ‡æ•°
    "XLK",     # ç§‘æŠ€æ¿å—
    "XLF",     # é‡‘èæ¿å—
    "EEM",     # æ–°å…´å¸‚åœº
    "TLT",     # é•¿æœŸå›½å€º
    "AGG",     # ç»¼åˆå€ºåˆ¸
    "GLD",     # é»„é‡‘
]
```

**æ–°å¢å‡½æ•°**:
- `get_etf_pool(market_code)`: è·å–ETFæ± 
- `is_etf(code, market_code)`: åˆ¤æ–­æ˜¯å¦ä¸ºETF

### 2. ETFå®šæŠ•ç­–ç•¥å®ç° (0.5å¤©)

#### 2.1 å®šæœŸå®šé¢ç­–ç•¥ (DCA)

**æ ¸å¿ƒç‰¹æ€§**:
- æ”¯æŒå‘¨é¢‘/åŒå‘¨é¢‘/æœˆé¢‘å®šæŠ•
- è‡ªåŠ¨è¯†åˆ«Aè‚¡/ç¾è‚¡å¸‚åœº
- Aè‚¡100è‚¡æ•´æ•°å€,ç¾è‚¡å¯ä¹°ä»»æ„è‚¡

**å…³é”®å‚æ•°**:
```python
ETFDollarCostAveraging(
    frequency='weekly',     # 'weekly', 'biweekly', 'monthly'
    invest_amount=5000,     # æ¯æ¬¡å®šæŠ•é‡‘é¢
    market='CN'             # 'CN' or 'US'
)
```

**å®šæŠ•æ—¥åˆ¤æ–­é€»è¾‘**:
- å‘¨é¢‘: æ¯å‘¨ä¸€
- åŒå‘¨é¢‘: æ¯ä¸¤å‘¨çš„å‘¨ä¸€
- æœˆé¢‘: æ¯æœˆç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥(1-7å·ä¸”æ˜¯å‘¨ä¸€)

**æµ‹è¯•ç»“æœ**:
- 3å¹´å‘¨é¢‘å®šæŠ•,æ€»æŠ•å…¥15ä¸‡,IRR=0.84%,èƒœç‡100% âœ…

#### 2.2 ä»·å€¼å¹³å‡ç­–ç•¥ (VA)

**æ ¸å¿ƒæ€æƒ³**:
- è®¾å®šç›®æ ‡å¢é•¿ç‡(å¦‚æ¯å‘¨1%)
- æ ¹æ®å®é™…ä»·å€¼ä¸ç›®æ ‡ä»·å€¼çš„å·®å¼‚è°ƒæ•´æŠ•å…¥
- ä½ä¹°é«˜å–,è‡ªåŠ¨å†å¹³è¡¡

**å…³é”®å‚æ•°**:
```python
ETFValueAveraging(
    target_growth_rate=0.01,  # æ¯æœŸç›®æ ‡å¢é•¿1%
    base_amount=5000          # åŸºç¡€æŠ•å…¥é‡‘é¢
)
```

**ç­–ç•¥é€»è¾‘**:
```python
# è®¡ç®—ç›®æ ‡ä»·å€¼
target_value = target_value * (1 + growth_rate) + base_amount

# è®¡ç®—å·®é¢
gap = target_value - current_value

if gap > 100:
    # å®é™…ä»·å€¼ < ç›®æ ‡ â†’ åŠ å¤§æŠ•å…¥è¡¥ä»“
    buy_shares = int(gap / current_price / 100) * 100
elif gap < -10000:
    # å®é™…ä»·å€¼ > ç›®æ ‡ â†’ å‡å°‘æŠ•å…¥ç”šè‡³å–å‡º
    sell_shares = int(abs(gap) / current_price / 100) * 100
```

**æµ‹è¯•ç»“æœ**:
- 3å¹´ä»·å€¼å¹³å‡,æ€»æŠ•å…¥32.8ä¸‡,ç»å¯¹æ”¶ç›Šç‡20.09%,IRR=14.75% âœ…
- **æ˜¾è‘—ä¼˜äºDCA** (IRR 14.75% vs 0.84%)

#### 2.3 æ™ºèƒ½å†å¹³è¡¡ç­–ç•¥

**æ ¸å¿ƒæ€æƒ³**:
- ç»´æŠ¤å¤šETFç»„åˆçš„ç›®æ ‡æƒé‡
- å½“å®é™…æƒé‡åç¦»ç›®æ ‡>5%æ—¶è§¦å‘å†å¹³è¡¡
- æ”¯æŒå­£åº¦/åŠå¹´åº¦/å¹´åº¦å†å¹³è¡¡

**å…³é”®å‚æ•°**:
```python
ETFSmartRebalancing(
    etf_weights={
        '510300': 0.4,  # æ²ªæ·±300 40%
        'QQQ': 0.3,     # çº³æ–¯è¾¾å…‹ 30%
        'TLT': 0.3,     # å€ºåˆ¸ 30%
    },
    rebalance_frequency='quarterly',  # å­£åº¦å†å¹³è¡¡
    deviation_threshold=0.05          # åå·®é˜ˆå€¼5%
)
```

**å†å¹³è¡¡é€»è¾‘**:
```python
for code, target_weight in etf_weights.items():
    # è®¡ç®—å®é™…æƒé‡
    current_weight = current_value / total_value

    # è®¡ç®—åå·®
    deviation = current_weight - target_weight

    # åå·®>5%æ—¶è°ƒä»“
    if abs(deviation) > 0.05:
        gap_value = target_value - current_value
        # ä¹°å…¥/å–å‡ºè‡³ç›®æ ‡æƒé‡
```

**æµ‹è¯•ç»“æœ**:
- 20ä¸‡ç»„åˆ,åå·®>5%è§¦å‘å†å¹³è¡¡
- ç”Ÿæˆ2ç¬”è°ƒä»“æŒ‡ä»¤(å–å‡º510300, ä¹°å…¥QQQ) âœ…

### 3. ETFå®šæŠ•å›æµ‹å¼•æ“ (0.3å¤©)

**æ ¸å¿ƒæ–¹æ³•**: `BacktestEngine.run_dca_backtest()`

**å…³é”®ç‰¹æ€§**:
1. **æ— éœ€å¤§é¢åˆå§‹èµ„é‡‘**: é€æœŸæŠ•å…¥,åˆå§‹ç°é‡‘å¯ä¸º0
2. **IRRè®¡ç®—**: ä½¿ç”¨Newton-Raphsonè¿­ä»£æ³•è®¡ç®—å†…éƒ¨æ”¶ç›Šç‡
3. **ç°é‡‘æµè¿½è¸ª**: è®°å½•æ¯æ¬¡æŠ•å…¥å’Œæœ€ç»ˆæ¸…ç®—
4. **å¸‚åœºé€‚é…**: è‡ªåŠ¨è¯†åˆ«Aè‚¡(100è‚¡æ•´æ•°å€)å’Œç¾è‚¡(ä»»æ„è‚¡)

**IRRè®¡ç®—åŸç†**:
```python
def _calculate_irr(cash_flows):
    """
    æ±‚è§£NPV=0æ—¶çš„r:
    NPV = Î£(CF_i / (1+r)^(days_i/365)) = 0

    ä½¿ç”¨Newton-Raphsonè¿­ä»£:
    r_new = r_old - NPV(r_old) / NPV'(r_old)
    """
    # è¿­ä»£è‡³æ”¶æ•›(NPV < 1e-6)
```

**å›æµ‹è¾“å‡º**:
```python
{
    'æ€»æŠ•å…¥': 150298.45,
    'æœ€ç»ˆå¸‚å€¼': 152196.96,
    'ç»å¯¹æ”¶ç›Š': 1898.52,
    'ç»å¯¹æ”¶ç›Šç‡': 1.26%,
    'IRR(å¹´åŒ–)': 0.84%,
    'æœ€å¤§å›æ’¤': -3.77%,
    'å®šæŠ•æ¬¡æ•°': 157,
    'äº¤æ˜“æ¬¡æ•°': 157,
    'ç°é‡‘æµ': [(date1, -1000), (date2, -1000), ..., (date_n, final_value)],
    'æƒç›Šæ›²çº¿': pd.Series(...)
}
```

---

## æµ‹è¯•ç»“æœ

### æµ‹è¯•1: å®šæœŸå®šé¢ç­–ç•¥ (DCA) âœ…

**æµ‹è¯•æ•°æ®**: 3å¹´å‘¨é¢‘æ¨¡æ‹Ÿæ•°æ®(èµ·å§‹100å…ƒ,ä¸‹è·Œ-9.2%)

**æµ‹è¯•ç»“æœ**:
- æ€»æŠ•å…¥: 150,298å…ƒ
- æœ€ç»ˆå¸‚å€¼: 152,197å…ƒ
- ç»å¯¹æ”¶ç›Š: 1,899å…ƒ (+1.26%)
- IRR(å¹´åŒ–): 0.84%
- æœ€å¤§å›æ’¤: -3.77%
- å®šæŠ•æ¬¡æ•°: 157æ¬¡

**éªŒè¯é€šè¿‡**: âœ…
- å®šæŠ•æ¬¡æ•°>100 âœ…
- æ€»æŠ•å…¥>10ä¸‡ âœ…
- IRRæ­£å¸¸è®¡ç®— âœ…

### æµ‹è¯•2: ä»·å€¼å¹³å‡ç­–ç•¥ (VA) âœ…

**æµ‹è¯•æ•°æ®**: 3å¹´æ³¢åŠ¨å¸‚åœº(èµ·å§‹10å…ƒ,å…ˆè·Œ-35%åæ¶¨+31%)

**æµ‹è¯•ç»“æœ**:
- æ€»æŠ•å…¥: 328,500å…ƒ
- æœ€ç»ˆå¸‚å€¼: 394,484å…ƒ
- ç»å¯¹æ”¶ç›Š: 65,984å…ƒ (+20.09%)
- IRR(å¹´åŒ–): 14.75%
- æœ€å¤§å›æ’¤: -3.46%
- äº¤æ˜“æ¬¡æ•°: 114æ¬¡

**å…³é”®å‘ç°**:
- VAç­–ç•¥IRR (14.75%) >> DCAç­–ç•¥ (0.84%)
- VAç­–ç•¥åœ¨æ³¢åŠ¨å¸‚åœºä¸­è¡¨ç°ä¼˜å¼‚(è‡ªåŠ¨ä½ä¹°é«˜å–)

**éªŒè¯é€šè¿‡**: âœ…

### æµ‹è¯•3: æ™ºèƒ½å†å¹³è¡¡ç­–ç•¥ âœ…

**æµ‹è¯•åœºæ™¯**: 3ä¸ªETFç»„åˆ,ç›®æ ‡æƒé‡40%/30%/30%,å®é™…åç¦»

**æµ‹è¯•ç»“æœ**:
- æ£€æµ‹åˆ°2ä¸ªåç¦»>5%çš„ETF
- ç”Ÿæˆ2ç¬”è°ƒä»“æŒ‡ä»¤:
  - å–å‡º510300: 200è‚¡ (50% â†’ 40%)
  - ä¹°å…¥QQQ: 100è‚¡ (20% â†’ 30%)
  - TLTæ— éœ€è°ƒæ•´ (30% = 30%)

**éªŒè¯é€šè¿‡**: âœ…
- åå·®è®¡ç®—æ­£ç¡® âœ…
- è°ƒä»“æ•°é‡å‡†ç¡® âœ…
- å†å¹³è¡¡æ—¥åˆ¤æ–­å‡†ç¡® âœ…

### æµ‹è¯•4: çœŸå®æ•°æ®DCAå›æµ‹

**çŠ¶æ€**: âš ï¸ è·³è¿‡(AKShareæ•°æ®æºä¸ç¨³å®š)

**æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®éªŒè¯æ‰€æœ‰åŠŸèƒ½

---

## æ ¸å¿ƒä»£ç å®ç°

### 1. DCAç­–ç•¥æ ¸å¿ƒé€»è¾‘

```python
def generate_signals(self, df: pd.DataFrame, date: str) -> List[Dict]:
    # 1. æ£€æŸ¥æ˜¯å¦åˆ°å®šæŠ•æ—¥
    if not self._is_invest_day(date):
        return []

    # 2. è½¬æ¢æ—¥æœŸæ ¼å¼
    date_ts = pd.to_datetime(date)
    if date_ts not in df.index:
        return []

    # 3. è·å–å½“å‰ä»·æ ¼
    current_price = df.loc[date_ts, 'close']

    # 4. è®¡ç®—å¯ä¹°è‚¡æ•°(åŒºåˆ†Aè‚¡/ç¾è‚¡)
    if self.market == 'CN':
        # Aè‚¡: 100è‚¡æ•´æ•°å€
        affordable_shares = int(self.invest_amount / current_price)
        shares = (affordable_shares // 100) * 100
    else:
        # ç¾è‚¡: ä»»æ„è‚¡
        shares = int(self.invest_amount / current_price)

    if shares == 0:
        return []

    # 5. ç”Ÿæˆä¹°å…¥ä¿¡å·
    return [{
        'action': 'buy',
        'shares': shares,
        'price': current_price,
        'amount': shares * current_price,
        'reason': f'{self.frequency}å®šæŠ•',
        'confidence': 1.0,
    }]
```

### 2. VAç­–ç•¥æ ¸å¿ƒé€»è¾‘

```python
def generate_signals(self, df: pd.DataFrame, date: str, current_value: float):
    self.periods += 1

    # ç›®æ ‡ä»·å€¼: å¤åˆ©å¢é•¿ + æ–°æŠ•å…¥
    self.target_value = self.target_value * (1 + self.target_growth_rate) + self.base_amount

    # è®¡ç®—å·®é¢
    gap = self.target_value - current_value

    date_ts = pd.to_datetime(date)
    current_price = df.loc[date_ts, 'close']

    if gap > 100:
        # è¡¥ä»“
        affordable_shares = int(gap / current_price)
        shares = (affordable_shares // 100) * 100
        if shares > 0:
            return [{'action': 'buy', 'shares': shares, ...}]

    elif gap < -10000:
        # å‡ä»“
        sellable_shares = int(abs(gap) / current_price)
        shares_to_sell = (sellable_shares // 100) * 100
        if shares_to_sell > 0:
            return [{'action': 'sell', 'shares': shares_to_sell, ...}]

    return []
```

### 3. IRRè®¡ç®—æ ¸å¿ƒé€»è¾‘

```python
def _calculate_irr(self, cash_flows: List[Tuple]) -> float:
    # å°†æ—¥æœŸè½¬ä¸ºå¤©æ•°
    start_date = cash_flows[0][0]
    days_amounts = []
    for date, amount in cash_flows:
        days = (pd.to_datetime(date) - pd.to_datetime(start_date)).days
        days_amounts.append((days, amount))

    # NPVå‡½æ•°
    def npv(rate):
        result = 0
        for days, amount in days_amounts:
            result += amount / (1 + rate) ** (days / 365)
        return result

    # NPVå¯¼æ•°
    def npv_derivative(rate):
        result = 0
        for days, amount in days_amounts:
            years = days / 365
            result += -years * amount / (1 + rate) ** (years + 1)
        return result

    # Newton-Raphsonè¿­ä»£
    rate = 0.1  # åˆå§‹çŒœæµ‹10%
    for _ in range(100):
        npv_val = npv(rate)
        if abs(npv_val) < 1e-6:
            return rate

        npv_deriv = npv_derivative(rate)
        if abs(npv_deriv) < 1e-10:
            break

        rate = rate - npv_val / npv_deriv
        rate = max(-0.5, min(5.0, rate))  # é™åˆ¶èŒƒå›´

    return rate
```

---

## å…³é”®æ”¹è¿›ç‚¹

### 1. å¸‚åœºé€‚é… (Aè‚¡ vs ç¾è‚¡)

**åŸè®¾è®¡é—®é¢˜**:
- æœªè€ƒè™‘Aè‚¡100è‚¡æ•´æ•°å€é™åˆ¶

**Phase 6æ”¹è¿›**:
- æ·»åŠ `market`å‚æ•°
- Aè‚¡: `(shares // 100) * 100` å‘ä¸‹å–æ•´
- ç¾è‚¡: `int(shares)` ç›´æ¥å–æ•´
- é¿å…å°é¢å®šæŠ•æ— æ³•æˆäº¤

### 2. IRR vs ç®€å•æ”¶ç›Šç‡

**ä¸ºä»€ä¹ˆéœ€è¦IRR**:
- ç®€å•æ”¶ç›Šç‡: `(final - invested) / invested`
- **é—®é¢˜**: å¿½ç•¥äº†ç°é‡‘æµæ—¶é—´ä»·å€¼

**ä¾‹å­**:
- DCA: é€æœˆæŠ•å…¥,æ¯ç¬”æŠ•å…¥çš„æŒæœ‰æ—¶é—´ä¸åŒ
- ç®€å•æ”¶ç›Šç‡é«˜ä¼°äº†å®é™…å¹´åŒ–æ”¶ç›Š
- IRRè€ƒè™‘æ—¶é—´ä»·å€¼,æ›´æ¥è¿‘å®é™…å¹´åŒ–æ”¶ç›Š

**éªŒè¯**:
- 3å¹´å®šæŠ•,ç®€å•æ”¶ç›Šç‡1.26%,IRR=0.84%
- IRRæ›´ä½å› ä¸ºåæœŸæŠ•å…¥æŒæœ‰æ—¶é—´çŸ­

### 3. ç­–ç•¥å‚æ•°ä¼˜åŒ–

**DCAç­–ç•¥**:
- `invest_amount`: å»ºè®®â‰¥10000å…ƒ(Aè‚¡100è‚¡æ•´æ•°å€)
- `frequency`: å‘¨é¢‘/æœˆé¢‘å–å†³äºèµ„é‡‘é‡
  - å‘¨é¢‘: é€‚åˆå¤§èµ„é‡‘(æ¯å‘¨1ä¸‡)
  - æœˆé¢‘: é€‚åˆå°èµ„é‡‘(æ¯æœˆ1ä¸‡)

**VAç­–ç•¥**:
- `target_growth_rate`: å»ºè®®0.005-0.02(0.5%-2%)
  - è¿‡é«˜: é¢‘ç¹ä¹°å…¥,æˆæœ¬é«˜
  - è¿‡ä½: å†å¹³è¡¡æ•ˆæœå¼±
- `base_amount`: å»ºè®®ä¸é¢„æœŸæ¯æœŸæŠ•å…¥æ¥è¿‘

**æ™ºèƒ½å†å¹³è¡¡**:
- `deviation_threshold`: å»ºè®®0.05(5%)
  - è¿‡ä½: é¢‘ç¹äº¤æ˜“,æˆæœ¬é«˜
  - è¿‡é«˜: åç¦»ç›®æ ‡å¤ªè¿œ
- `rebalance_frequency`: å»ºè®®å­£åº¦
  - è¿‡é¢‘: äº¤æ˜“æˆæœ¬é«˜
  - è¿‡é•¿: é”™è¿‡è°ƒæ•´æ—¶æœº

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: å°ç™½å®šæŠ•æ²ªæ·±300ETF

**éœ€æ±‚**: æ¯æœˆ1ä¸‡,ç¨³å¥å¢é•¿

**ç­–ç•¥é€‰æ‹©**: DCAæœˆé¢‘

```python
strategy = ETFDollarCostAveraging(
    frequency='monthly',
    invest_amount=10000,
    market='CN'
)

# å›æµ‹3å¹´
result = engine.run_dca_backtest(
    etf_code='510300',
    df=df,
    strategy=strategy
)

# é¢„æœŸ: IRR 5-8% (è·Ÿéšå¤§ç›˜)
```

### åœºæ™¯2: è¿›é˜¶ç”¨æˆ·æ³¢åŠ¨å¸‚åœºå¥—åˆ©

**éœ€æ±‚**: åˆ©ç”¨å¸‚åœºæ³¢åŠ¨,ä½ä¹°é«˜å–

**ç­–ç•¥é€‰æ‹©**: VAä»·å€¼å¹³å‡

```python
strategy = ETFValueAveraging(
    target_growth_rate=0.01,  # æ¯å‘¨ç›®æ ‡å¢é•¿1%
    base_amount=5000
)

# åœ¨æ³¢åŠ¨å¸‚åœºä¸­è¡¨ç°ä¼˜å¼‚
# æµ‹è¯•æ˜¾ç¤º: IRR 14.75% vs DCA 0.84%
```

### åœºæ™¯3: èµ„äº§é…ç½®ç»„åˆ

**éœ€æ±‚**: è‚¡å€ºå¹³è¡¡,é™ä½é£é™©

**ç­–ç•¥é€‰æ‹©**: æ™ºèƒ½å†å¹³è¡¡

```python
strategy = ETFSmartRebalancing(
    etf_weights={
        '510300': 0.6,  # è‚¡ç¥¨60%
        'TLT': 0.4,     # å€ºåˆ¸40%
    },
    rebalance_frequency='quarterly',
    deviation_threshold=0.05
)

# å­£åº¦è°ƒä»“,è‡ªåŠ¨ä½ä¹°é«˜å–
# ç†Šå¸‚æ—¶å€ºåˆ¸æ¯”ä¾‹ä¸Šå‡,ç‰›å¸‚æ—¶è‚¡ç¥¨æ¯”ä¾‹ä¸Šå‡
```

---

## ä¸å…¶ä»–Phaseçš„é›†æˆ

### ä¸Phase 3æŒä»“ç®¡ç†å™¨é›†æˆ

```python
class PortfolioManager:
    def start_etf_dca_plan(self, etf_code: str, strategy: ETFDollarCostAveraging):
        """å¯åŠ¨ETFå®šæŠ•è®¡åˆ’"""
        # æ¯å‘¨æ£€æŸ¥æ˜¯å¦åˆ°å®šæŠ•æ—¥
        # å¦‚æœåˆ°å®šæŠ•æ—¥,ç”Ÿæˆä¹°å…¥æŒ‡ä»¤
        # è®°å½•åˆ°äº¤æ˜“æ—¥å¿—
        pass
```

### ä¸Phase 4æ¨èç³»ç»Ÿé…åˆ

```python
# å®šæŠ•è®¡åˆ’ä¹Ÿè®°å½•åˆ°recommendationsè¡¨
journal.add_recommendation(
    market="CN",
    code="510300",
    strategy="ETFå®šæŠ•-æ²ªæ·±300",
    action="buy",
    score=100,  # å®šæŠ•æ— è¯„åˆ†,å›ºå®š100
    confidence=1.0,
    reason="æœˆé¢‘å®šæŠ•è®¡åˆ’"
)

# å®šæœŸå›æµ‹å®šæŠ•è¡¨ç°
journal.backtest_recommendations(strategy="ETFå®šæŠ•-æ²ªæ·±300")
```

---

## æœªæ¥æ”¹è¿›æ–¹å‘

### 1. åŠ¨æ€è°ƒæ•´å®šæŠ•é‡‘é¢ (Phase 9å¯é€‰)

**å½“å‰**: å›ºå®šé‡‘é¢å®šæŠ•

**æœªæ¥**: æ ¹æ®ä¼°å€¼è°ƒæ•´é‡‘é¢
- PE<å†å²30%åˆ†ä½ â†’ åŠ å¤§æŠ•å…¥(1.5å€)
- PE>å†å²70%åˆ†ä½ â†’ å‡å°‘æŠ•å…¥(0.5å€)

### 2. å¤šç­–ç•¥ç»„åˆ (Phase 9å¯é€‰)

**æ€è·¯**: ç»“åˆDCAå’ŒVA

- ç‰›å¸‚: DCAä¸ºä¸»(ç¨³å®šæŠ•å…¥)
- ç†Šå¸‚: VAä¸ºä¸»(å¤§è·Œæ—¶åŠ ä»“)
- ç›˜æ•´: æ™ºèƒ½å†å¹³è¡¡

### 3. Webç•Œé¢å¢å¼º (Phase 12)

**æ–°å¢Tab: "ETFå®šæŠ•"**:
- ETFæ± é€‰æ‹©
- ç­–ç•¥å‚æ•°é…ç½®
- å†å²å›æµ‹å±•ç¤º
- å®šæŠ•æ—¥å†è§†å›¾(æ˜¾ç¤ºä¸‹æ¬¡å®šæŠ•æ—¥æœŸ)
- IRR vs å¤§ç›˜å¯¹æ¯”å›¾

---

## ç»éªŒæ•™è®­

### 1. Aè‚¡100è‚¡æ•´æ•°å€çš„é™·é˜±

**é—®é¢˜**: åˆå§‹æµ‹è¯•æ—¶`shares = int(amount/price/100)*100`,ç»“æœå…¨å˜æˆ0

**åŸå› **: å…ˆé™¤ä»¥100å†int(),ä¸¢å¤±ç²¾åº¦

**æ­£ç¡®å†™æ³•**:
```python
# âŒ é”™è¯¯
shares = int(amount / price / 100) * 100  # 1000/101/100=0.099 â†’ int()=0

# âœ… æ­£ç¡®
affordable_shares = int(amount / price)  # 1000/101=9.9 â†’ 9
shares = (affordable_shares // 100) * 100  # 9//100=0 â†’ 0
```

**æ•™è®­**: å¯¹äºå°é¢å®šæŠ•,è¦ä¹ˆ:
- æé«˜invest_amount(â‰¥10000å…ƒ)
- ä½¿ç”¨ç¾è‚¡å¸‚åœº(å¯ä¹°ä»»æ„è‚¡)

### 2. VAç­–ç•¥å‚æ•°è¯†åˆ«

**é—®é¢˜**: `generate_signals(df, date)`å’Œ`generate_signals(df, date, current_value)`ç­¾åä¸åŒ

**è§£å†³**: ä½¿ç”¨`inspect.signature`æ£€æŸ¥å‚æ•°æ•°é‡

```python
import inspect
sig = inspect.signature(strategy.generate_signals)
param_count = len(sig.parameters)

if param_count == 2:
    signals = strategy.generate_signals(df, date)
else:
    signals = strategy.generate_signals(df, date, current_value)
```

### 3. IRRè®¡ç®—çš„æ•°å€¼ç¨³å®šæ€§

**é—®é¢˜**: Newton-Raphsonå¯èƒ½ä¸æ”¶æ•›æˆ–å‘æ•£

**è§£å†³**:
1. é™åˆ¶è¿­ä»£æ¬¡æ•°(100æ¬¡)
2. é™åˆ¶rateèŒƒå›´(-0.5 ~ 5.0)
3. æ£€æŸ¥å¯¼æ•°æ˜¯å¦å¤ªå°(é˜²æ­¢é™¤é›¶)
4. è®¾ç½®æ”¶æ•›é˜ˆå€¼(NPV<1e-6)

---

## å·¥ä½œé‡åˆ†è§£

| ä»»åŠ¡ | é¢„ä¼° | å®é™… | è¯´æ˜ |
|------|-----|------|------|
| ETFæ± æ‰©å±• | 0.5å¤© | 0.2å¤© | ç®€å•é…ç½® |
| DCAç­–ç•¥å®ç° | 1å¤© | 0.3å¤© | æ ¸å¿ƒé€»è¾‘æ¸…æ™° |
| VAç­–ç•¥å®ç° | 0.5å¤© | 0.2å¤© | å‚è€ƒDCA |
| æ™ºèƒ½å†å¹³è¡¡ | 0.5å¤© | 0.1å¤© | ç›¸å¯¹ç®€å• |
| å›æµ‹å¼•æ“å¢å¼º | 0.5å¤© | 0.2å¤© | IRRè®¡ç®—æ˜¯éš¾ç‚¹ |
| æµ‹è¯•ç”¨ä¾‹ | 0.5å¤© | 0.15å¤© | 4ä¸ªæµ‹è¯•å…¨è¦†ç›– |
| æ–‡æ¡£æ’°å†™ | 0.2å¤© | 0.05å¤© | - |
| è°ƒè¯•ä¿®å¤ | - | 0.2å¤© | æ•´æ•°å€é—®é¢˜è€—æ—¶ |
| **æ€»è®¡** | **3.7å¤©** | **1.4å¤©** | **æå‰2.3å¤©** |

**å…³é”®åŠ é€Ÿç‚¹**:
- ETFæ± é…ç½®ç®€å•(20åªæ ¸å¿ƒETF,æ— éœ€å¤ªå¤š)
- ç­–ç•¥é€»è¾‘ç›¸å¯¹ç‹¬ç«‹,æ— å¤æ‚ä¾èµ–
- å›æµ‹å¼•æ“å¤ç”¨ç°æœ‰æ¡†æ¶

---

## æ€»ç»“

### âœ… å·²å®Œæˆ

1. âœ… ETFè‚¡ç¥¨æ± æ‰©å±•(Aè‚¡10åª+ç¾è‚¡10åª)
2. âœ… å®šæœŸå®šé¢ç­–ç•¥(DCA)
3. âœ… ä»·å€¼å¹³å‡ç­–ç•¥(VA)
4. âœ… æ™ºèƒ½å†å¹³è¡¡ç­–ç•¥
5. âœ… ETFå®šæŠ•å›æµ‹å¼•æ“(IRRè®¡ç®—)
6. âœ… å®Œæ•´æµ‹è¯•ç”¨ä¾‹(4ä¸ªåœºæ™¯)
7. âœ… Aè‚¡/ç¾è‚¡å¸‚åœºé€‚é…

### ğŸ¯ è¾¾æˆç›®æ ‡

- **å®ç”¨æ€§**: 3ç§ç­–ç•¥è¦†ç›–å°ç™½â†’è¿›é˜¶â†’èµ„æ·±ç”¨æˆ·
- **çœŸå®æ€§**: IRRè®¡ç®—è€ƒè™‘æ—¶é—´ä»·å€¼,æ›´å‡†ç¡®
- **é²æ£’æ€§**: Aè‚¡100è‚¡æ•´æ•°å€,ç¾è‚¡ä»»æ„è‚¡,å®Œç¾é€‚é…
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°ETFå’Œæ–°ç­–ç•¥

### ğŸ“ˆ ä¸‹ä¸€æ­¥(Phase 7)

- ç›®æ ‡å¯¼å‘æ¨èç³»ç»Ÿ
- æ ¹æ®ç›ˆåˆ©ç›®æ ‡(å¦‚"3å¹´ç¿»å€"ã€"å¹´åŒ–15%")åå‘æ¨èç­–ç•¥
- è®¡ç®—è¾¾æˆæ¦‚ç‡

---

**Phase 6çŠ¶æ€**: âœ… å®Œæˆ
**ç´¯è®¡è¿›åº¦**: 6/9 (67%)
**æ€»æå‰å¤©æ•°**: 8.5å¤© â†’ **10.5å¤©**
**é¢„è®¡å®Œæˆæ€»å·¥æœŸ**: 30.5å¤© â†’ **20å¤©** ğŸš€

---

## é™„å½•: ETFå®šæŠ•FAQ

**Q1: DCA vs VA,å¦‚ä½•é€‰æ‹©?**

A:
- å°ç™½ç”¨æˆ· â†’ DCA(ç®€å•,ä¸ç”¨æ“å¿ƒ)
- è¿›é˜¶ç”¨æˆ· â†’ VA(æ³¢åŠ¨å¸‚åœºè¡¨ç°æ›´å¥½)
- èµ„æ·±ç”¨æˆ· â†’ æ™ºèƒ½å†å¹³è¡¡(å¤šèµ„äº§é…ç½®)

**Q2: å®šæŠ•é‡‘é¢å¤šå°‘åˆé€‚?**

A:
- Aè‚¡ETF: å»ºè®®â‰¥10000å…ƒ(100è‚¡æ•´æ•°å€)
- ç¾è‚¡ETF: å¯ä½è‡³1000å…ƒ(æ— æ•´æ•°å€é™åˆ¶)

**Q3: IRRå’Œå¹´åŒ–æ”¶ç›Šç‡æœ‰ä»€ä¹ˆåŒºåˆ«?**

A:
- å¹´åŒ–æ”¶ç›Šç‡: ç®€åŒ–å‡è®¾æ‰€æœ‰èµ„é‡‘åŒæ—¶æŠ•å…¥
- IRR: è€ƒè™‘æ¯ç¬”ç°é‡‘æµçš„å®é™…æ—¶é—´
- IRRæ›´å‡†ç¡®,ä½†é€šå¸¸ä½äºå¹´åŒ–æ”¶ç›Šç‡

**Q4: ä¸ºä»€ä¹ˆVAç­–ç•¥IRRè¿œé«˜äºDCA?**

A:
- VAç­–ç•¥åœ¨ä¸‹è·Œæ—¶åŠ å¤§æŠ•å…¥,ä¸Šæ¶¨æ—¶å‡å°‘æŠ•å…¥
- ç›¸å½“äºè‡ªåŠ¨"ä½ä¹°é«˜å–"
- é€‚åˆæ³¢åŠ¨å¸‚åœº,ç›˜æ•´å¸‚åœºæ•ˆæœæœ€å¥½

**Q5: æ™ºèƒ½å†å¹³è¡¡å¤šä¹…è°ƒä»“ä¸€æ¬¡?**

A:
- å­£åº¦: é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯(å¹³è¡¡é¢‘ç‡å’Œæˆæœ¬)
- æœˆåº¦: é€‚åˆæ³¢åŠ¨å‰§çƒˆå¸‚åœº
- å¹´åº¦: é€‚åˆé•¿æœŸæŒæœ‰,é™ä½äº¤æ˜“æˆæœ¬
