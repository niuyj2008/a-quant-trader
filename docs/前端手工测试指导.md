# 前端手工测试指导

本文档提供**详细的前端手工测试步骤**，帮助您验证Web界面（v4.0 整合版）的所有功能。

系统共 **7 个 Tab**：个股分析、持仓管理、市场扫描、策略回测、ETF定投、目标规划、策略实验室。

---

## 准备工作

### 1. 启动Web应用

```bash
cd /Users/niuyj/Downloads/workspace_Claude/stock/a-quant-trader
streamlit run src/web/app.py
```

**预期**: 浏览器自动打开 `http://localhost:8501`

### 2. 检查初始界面

- ✅ 页面标题为"📊 量化策略决策支持系统"
- ✅ 左侧边栏显示：市场选择（A股/美股）、历史数据年数滑块
- ✅ 顶部有 **7 个 Tab 标签**
- ✅ 无报错信息

### 3. 侧边栏配置

**操作步骤**:
1. 市场选择：默认"A股"
2. 历史数据年数：默认3年

**测试数据**:
- A股有效代码: `600519`, `000001`, `000858`, `601318`
- 美股有效代码: `AAPL`, `MSFT`, `GOOGL`

---

## Tab 1: 📊 个股分析

> 合并了原"个股策略"+"行情分析"+"因子研究"，一站式分析单只股票。

### 1.1 输入与分析

**操作步骤**:
1. 点击"📊 个股分析" Tab
2. 输入股票代码（如 `000001`）
3. 选择策略（默认全选6种）
4. 点击"🚀 开始分析"按钮

**预期结果**:
- ✅ 显示股票名称和代码
- ✅ 显示4个基本信息卡片：当前价格、最高价、最低价、成交量
- ✅ 出现3个子Tab：「📋 策略信号」「📈 行情走势」「🔬 因子研究」

### 1.2 子Tab: 策略信号

**检查项**:
- ✅ 显示"💎 基本面评分"（综合评级 + 四维度：盈利能力、成长性、估值吸引力、财务健康）
- ✅ 显示策略信号概览表（策略名、信号、信号强度、风险等级、止损价）
- ✅ 信号用颜色标记（买入🟢、卖出🔴、持有🟡）
- ✅ 显示综合建议（买入/卖出/观望）
- ✅ 各策略详细分析Tab（含因子雷达图、因子贡献度条形图、决策理由、风险提示）

### 1.3 子Tab: 行情走势

**检查项**:
- ✅ 显示交互式K线图（含MA5、MA20、MA60均线）
- ✅ 包含成交量柱状图
- ✅ 显示RSI指标图（含超买70/超卖30基准线）
- ✅ 显示MACD指标图（含柱状图、信号线）

### 1.4 子Tab: 因子研究

**检查项**:
- ✅ 显示"🎓 学术因子评分"（综合评级、FF3因子、动量、质量、低波动、Beta）
- ✅ 显示学术因子雷达图
- ✅ 显示因子值一览（按类别展开：技术因子、基本面、宏观经济、市场情绪）
- ✅ 显示因子相关性矩阵热力图

---

## Tab 2: 💼 持仓管理

> 合并了原"持仓策略"+"交易记录"，集中管理持仓和交易历史。

### 2.1 子Tab: 持仓总览

**操作步骤**:
1. 点击"💼 持仓管理" Tab
2. 在「📊 持仓总览」子Tab中操作

**检查项**:
- ✅ 显示"添加/管理持仓"可展开区域
- ✅ 可输入股票代码、买入价格、持仓数量并添加
- ✅ 有持仓时显示持仓仪表盘（总市值、总成本、浮动盈亏、持仓数量、盈/亏）
- ✅ 显示行业分布饼图 + Top5持仓表
- ✅ 显示"调仓计划生成"区域，点击按钮可生成买入/卖出操作清单

### 2.2 子Tab: 策略分析

**操作步骤**:
1. 切换到「📋 策略分析」子Tab
2. 选择一个分析策略
3. 点击"🔄 分析持仓建议"按钮

**预期结果**:
- ✅ 显示每只持仓的建议表（代码、成本价、现价、盈亏、建议、信号强度、预警、理由）
- ✅ 触及止损线的显示"⚠️ 触发止损"
- ✅ 盈利超过30%的显示"🎯 建议止盈"
- ✅ 可展开查看每只持仓的详细建议

### 2.3 子Tab: 交易记录

**检查项**:
- ✅ 「交易明细」Tab显示交易历史列表（日期、代码、方向、价格、数量等）
- ✅ 「绩效统计」Tab显示总交易次数、买入/卖出次数、总交易金额

---

## Tab 3: 🎯 市场扫描

### 3.1 生成推荐

**操作步骤**:
1. 点击"🎯 市场扫描" Tab
2. 选择策略和推荐数量
3. 点击"🔎 开始扫描"按钮

**预期结果**:
- ✅ 显示推荐列表（排名、代码、信号、综合得分、信号强度、现价、止损价、核心理由）
- ✅ 按综合得分降序排列
- ✅ Top5推荐可展开查看详细分析（含因子雷达图）

### 3.2 策略胜率对比

**检查项**:
- ✅ 显示"📊 策略胜率对比分析"区域
- ✅ 胜率低于45%的策略显示"⚠️ 警告"标记
- ✅ 显示对比表格（策略名、推荐数、1周/1月/3月胜率和均收益）
- ✅ 显示多周期胜率对比柱状图

### 3.3 历史推荐回顾

**检查项**:
- ✅ 显示最近20条历史推荐记录
- ✅ 显示推荐胜率（有数据时）

---

## Tab 4: 🧪 策略回测

> 合并了原"策略回测"+"专业报告"，通过切换报告详细程度选择标准/专业模式。

### 4.1 运行回测

**操作步骤**:
1. 点击"🧪 策略回测" Tab
2. 输入回测标的、日期范围、策略
3. 选择报告详细程度：「标准报告」或「专业报告(30+指标)」
4. 点击"开始回测"按钮

**预期结果（标准报告）**:
- ✅ 显示策略收益 vs 买入持有对比曲线
- ✅ 显示6个基础绩效指标：总收益、年化收益、夏普比率、最大回撤、买入周数、持仓胜率
- ✅ 显示策略健康评分（健康评分/100、评级、收益、夏普、回撤控制、稳定性）

### 4.2 专业报告模式

**操作步骤**:
1. 选择"专业报告(30+指标)"
2. 点击"开始回测"

**预期结果（在标准报告基础上额外显示）**:
- ✅ **收益指标**: 总收益率、年化收益率、CAGR、日均收益率、正收益月占比
- ✅ **风险指标**: 年化波动率、最大回撤、VaR(95%)、CVaR(95%)、下行波动率
- ✅ **风险调整收益**: 夏普比率、Sortino比率、Calmar比率、Alpha、Beta
- ✅ **交易指标**: 交易次数、胜率、盈亏比、最大连续盈利、最大连续亏损
- ✅ 权益曲线图
- ✅ 月度收益热力表（正收益绿色、负收益红色）
- ✅ Top 5 回撤事件表（开始日期、谷底、恢复、深度、持续天数）

---

## Tab 5: 💰 ETF定投

### 5.1 选择ETF和策略

**操作步骤**:
1. 点击"💰 ETF定投" Tab
2. 输入ETF代码（如 `510300`）
3. 选择定投策略：定期定额(DCA) / 价值平均(VA) / 智能再平衡
4. 设置定投频率和每次金额
5. 点击"开始定投回测"按钮

**预期结果**:
- ✅ 显示5个核心指标：总投入、最终市值、总收益、IRR年化、定投次数
- ✅ 显示累计投入 vs 市值对比折线图
- ✅ 显示定投买入价格记录散点图（含平均成本线）

---

## Tab 6: 🎯 目标规划

### 6.1 设置投资目标

**操作步骤**:
1. 点击"🎯 目标规划" Tab
2. 设置投资期限、目标年化收益、风险承受、初始资金
3. 点击"生成推荐方案"按钮

**预期结果**:
- ✅ 显示推荐策略列表（总分、收益匹配、风险控制、稳定性、期限匹配）
- ✅ 每个策略显示历史表现（年化收益、夏普比率、最大回撤、达成概率）

### 6.2 蒙特卡洛模拟

**检查项**:
- ✅ 显示蒙特卡洛模拟路径图（100条路径 + 中位数 + 10%/90%分位 + 目标线）
- ✅ 显示达成目标的概率
- ✅ 显示最终资产价值分布直方图（含目标值和中位数标注）

---

## Tab 7: ⚡ 策略实验室

### 7.1 ML算法对比

**操作步骤**:
1. 点击"⚡ 策略实验室" Tab
2. 在「ML算法对比」子Tab中输入标的
3. 点击"运行ML对比"按钮

**预期结果**:
- ✅ 显示4个算法对比表（LightGBM、XGBoost、RandomForest、Ridge）
- ✅ 显示IC均值对比柱状图（最优算法绿色高亮）
- ✅ 推荐最优算法

### 7.2 策略集成

**操作步骤**:
1. 切换到「策略集成」子Tab
2. 选择子策略（多选）和集成方法（投票法/加权法/动态加权法）
3. 点击"运行集成测试"按钮

**预期结果**:
- ✅ 显示集成信号结果（方向、置信度）
- ✅ 投票法显示投票详情
- ✅ 加权法/动态加权法显示策略权重表

---

## 性能测试

### 页面加载速度

- ✅ 首页加载时间 < 5秒
- ✅ 切换Tab延迟 < 1秒
- ✅ 策略回测运行时间 < 30秒（1年数据）
- ✅ 专业报告生成时间 < 60秒

---

## 异常情况测试

### 无效输入

| 输入 | 位置 | 预期行为 |
|------|------|---------|
| `999999` | 股票代码 | 提示无效或数据获取失败 |
| 空白 | 股票代码 | 使用默认代码 |
| 非常短的日期范围 | 日期选择 | 提示数据不足或显示有限结果 |

### 数据缺失

**测试步骤**:
1. 输入一只停牌或退市股票代码
2. 尝试各Tab功能

**预期**:
- ✅ 显示友好的错误提示（st.warning 或 st.error）
- ✅ 不崩溃
- ✅ 建议更换股票代码

---

## 快速测试检查清单

如果时间有限，请至少完成以下**核心测试**:

### ✅ 核心功能（必测）

- [ ] **个股分析**: 输入`000001`，点击分析，查看策略信号/行情走势/因子研究三个子Tab
- [ ] **持仓管理**: 添加持仓，查看仪表盘、策略分析、交易记录
- [ ] **市场扫描**: 扫描推荐，查看胜率对比表和预警
- [ ] **策略回测（标准）**: 运行回测，查看收益曲线、绩效指标、健康评分
- [ ] **策略回测（专业）**: 切换专业模式，查看30+指标和月度收益热力表
- [ ] **ETF定投**: 输入510300，选择DCA策略，查看IRR
- [ ] **目标规划**: 设置3年15%目标，查看推荐和蒙特卡洛模拟
- [ ] **策略实验室**: 运行ML对比，查看算法对比柱状图

### ✅ 数据正确性（必测）

- [ ] 策略信号合理（不全是同一方向）
- [ ] 回测收益率合理（不出现异常高收益如1000%）
- [ ] 因子评分在合理范围内
- [ ] 蒙特卡洛模拟概率在0-100%之间

### ✅ 图表交互（必测）

- [ ] 所有 Plotly 图表可缩放、拖拽
- [ ] 悬停显示数据标签
- [ ] 饼图点击可高亮

---

## 测试记录模板

```
测试日期: ____-__-__
测试人员: [您的名字]
应用版本: v4.0 (整合版)

| Tab | 测试项 | 状态 | 备注 |
|-----|-------|------|------|
| 个股分析 | 策略信号子Tab | ✅/❌ | |
| 个股分析 | 行情走势子Tab | ✅/❌ | |
| 个股分析 | 因子研究子Tab | ✅/❌ | |
| 持仓管理 | 持仓总览 | ✅/❌ | |
| 持仓管理 | 策略分析 | ✅/❌ | |
| 持仓管理 | 交易记录 | ✅/❌ | |
| 市场扫描 | 扫描推荐 | ✅/❌ | |
| 市场扫描 | 胜率对比 | ✅/❌ | |
| 策略回测 | 标准报告 | ✅/❌ | |
| 策略回测 | 专业报告 | ✅/❌ | |
| ETF定投 | DCA回测 | ✅/❌ | |
| ETF定投 | IRR对比图 | ✅/❌ | |
| 目标规划 | 策略推荐 | ✅/❌ | |
| 目标规划 | 蒙特卡洛 | ✅/❌ | |
| 策略实验室 | ML对比 | ✅/❌ | |
| 策略实验室 | 策略集成 | ✅/❌ | |

问题汇总:
1. [严重/一般/轻微] 描述
2. ...
```

---

## 问题反馈

如遇到问题，请提供以下信息:

1. **问题描述**: 详细描述发生了什么
2. **复现步骤**: 如何一步步触发问题
3. **预期结果**: 您期望看到什么
4. **实际结果**: 实际看到了什么
5. **截图**: 如果可能，提供截图
6. **浏览器**: Chrome/Firefox/Safari + 版本号
7. **错误日志**: 查看终端（运行streamlit的窗口）的错误信息
